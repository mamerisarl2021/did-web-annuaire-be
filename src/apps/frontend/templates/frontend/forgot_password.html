{% extends "frontend/base.html" %}
{% block title %}Reset Password — AnnuaireDID{% endblock %}

{% block body %}
<div class="auth-page">
  <div class="card">
    <div class="brand">
      <h1><span>Annuaire</span>DID</h1>
      <p>Reset your password</p>
    </div>

    <div id="alert-box"></div>

    <div id="form-section">
      <p style="color: var(--text-muted); font-size: 0.875rem; line-height: 1.5; margin-bottom: 1.25rem;">
        Enter the email address associated with your account. We'll send you a link to reset your password.
      </p>

      <form onsubmit="handleReset(event)">
        <div class="form-group">
          <label for="email">Email</label>
          <input id="email" type="email" class="form-input" placeholder="you@organization.com" required>
        </div>
        <button type="submit" id="submit-btn" class="btn btn-primary">
          <span class="btn-label">Send Reset Link</span>
          <span class="htmx-indicator spinner"></span>
        </button>
      </form>

      <div class="text-center mt-2">
        <a href="{% url 'frontend:login' %}" class="link-muted" style="font-size: 0.8125rem;">← Back to Sign In</a>
      </div>
    </div>

    <div id="sent-section" class="hidden text-center">
      <div class="alert alert-success">If an account with that email exists, a reset link has been sent.</div>
      <a href="{% url 'frontend:login' %}" class="btn btn-primary mt-2">Back to Sign In</a>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  async function handleReset(e) {
    e.preventDefault();
    const btn = document.getElementById("submit-btn");
    const email = document.getElementById("email").value;

    clearAlert("alert-box");
    setLoading(btn, true);

    try {
      await Auth.passwordReset(email);
      document.getElementById("form-section").classList.add("hidden");
      document.getElementById("sent-section").classList.remove("hidden");
    } catch (err) {
      showAlert("alert-box", err.detail || "Something went wrong.");
    } finally {
      setLoading(btn, false);
    }
  }
</script>
{% endblock %}
